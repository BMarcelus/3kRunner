<body style="-webkit-user-select:none">
    <canvas width=680 height=450 style="height:100%">
    <script>
    //Copyright Brian Dizon 2018
    try{A=webkitAudioContext}catch(e){A=AudioContext}A=new A();
    function P(f){o=A.createOscillator();T=A.currentTime;o.start(0);o.stop(T+.07);o.type="square";
    o.frequency.setValueAtTime(f,T+.03);
    L=A.createGain();L.connect(A.destination);
    L.gain.value = 0.1;
    o.connect(L);
    };
    c=document.querySelector('canvas').getContext('2d');
    c.font="20px Arial";
    X=200;
    Y=J=100;
    vy=g=k=d=t=f=S=V=h=x=G=F=N=D=Z=0;Q=1;
    p=[];
    r=Math.random;
    y=250;
    B="#000";W='#eef';
    E=.8;
    function l(a,b){p.push(a),b||r()>E&&H()};
    function n(){r()<.3?(u(),u(1)):r()<.3?v():y=(y+=(e=.5-r())*190)<150?150:y>400?400:y,l([x+=100+r()*186,y,100,10])};
    function u(d){l([x+=100,y,100,d?18:10])};
    function H(){l([x+r()*79,y-15-r()*120,20,20],1)};
    function v(){l([x+=200,y-=120,50,100],1);l([x-100,y+=120,250,11]);x+=50;}
    C=(L)=>{c.fillStyle=L};
    c.T=c.fillText;
    c.R=c.fillRect;
    R=(x,y,w,H)=>x+w>=X&&x<X+30&&y+H>=Y+h&&y<=Y+30;
    function q(i,j,w,h,e) {
    w-2&&t&&R(i,j,w,h)&&(w-20?vy>=0&&Y<=j?(Y=j-30,g=vy=0,h-18||(V=10)):w-50||K():(f+=30,e[2]=2,P(880+440*(1-E)),G=F+3,E*=.992));
    C(B);
    w-2?w-20?c.R(x=i,j,w,h):c.T('<3',i,j+20,C('#e23')):(c.T('+30',i,j,C('#db0')),e[1]-=2);
    h-18||c.T('>>>>>>>>>',i,j);
    }
    function s() {
    F++;
    F%99||!D||(Z=(Z+1)%Q);
    D?C('#faa'):C(W);
    c.R(0,0,680,450);
    C(B);
    // g=g||vy>2; 
    t&&(vy+=[.4,.4,.3][Z]);
    Y+=vy;
    c.T(f,100,50);
    m=k*(vy>=0);
    c.R(200+(m?200:g*85),30,70,4);
    h+=m*7-h/2;
    V+=([5,5,4][Z]-V)/20;
    z=V*!D-(k||Z-2?0:-vy)
    p.forEach(e=>{q(e[0]-=z,e[1]+Math.cos(e[0]/100)*10,e[2],e[3],e)});
    x<=680&&n();
    p[0][0]<-p[0][2]&&p.shift();
    C(["#d26","#2a7","#62d"][Z])
    f>3000&&C("gold");
    c.R(X-vy/4,Y+h-(z==2?5:0),(Z==2?32:30)+vy/2,(z==1?35:30)-h);
    c.T(['M','▮▮','>FF'][Z], X-3-vy/4,Y+10+h);
    F<10&&F>2&&c.T(`Ɛ>${' '.repeat(F-2)}<3`,X+20-F*V,J);
    C('#fff');
    z='-.}'[Z];
    c.T(k||D?`>${z}<`:`^${z}^`, X+5,Y+20+vy+h/2);
    Y>450&&(Y=420,K());
    z=f<3000;
    I=[0,1,2,6][Q]*500;
    c.R(20,70,160,2),
    c.R(20,52,f/I*160,20),
    D&&(e=240+999/F,c.R(e-20,50,200,240),C(B),
    c.T(z?`<3's: ${f}`:'YAY u win',e,90),
    F>40&&c.T(`Best: ${S=f>S?f:S}`,e,120),
    c.R(e,148,160,2),
    c.R(e,130,f/I*160,20),
    c.T(Q-3?'new char at '+I:'final goal '+I,e,170),
    N&&F%25>10&&c.T('*New Char Unlocked!',250,350,C(W)),
    F%4||F>10&&F<35&&((z&&!N)?P(880-F*F*2):P(880+F*F)));
    F==G&&(P(1200),G=0);
    window.requestAnimationFrame(s);
    }
    s();
    function K(){
      t=vy=g=F=0,D=1,P(220),E=.8;
      f>500&&Q<2&&(N=Q=2),f>1000&&Q<3&&(N=Q=3)
    }
    function a(e) {
    e.metaKey||e.preventDefault();
    J=Y+20;
    !g||Z-1||(V=5);
    !D?(k||P(880-g*330-Y)||(g&&(vy+=10))||(J=Y+20,f+=!g*5),t||(f=N=0),k||(F=t=k=1)):F>50?(D=0,Y=100):0;
    }
    function b() {
    D||!k||g||(vy=-10,g=1,Z&&(V=10));
    k=0;
    }
    w=addEventListener.bind(window);
    w('keydown',a);
    w('keyup',b);
    w('touchstart',a,{passive:false});
    w('touchend',b);
    </script>
    </body>