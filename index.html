<style>*{height:100%;margin:0;}</style>
<canvas width=680 height=450>
<script>
//Copyright Brian Dizon 2018
try{A=webkitAudioContext}catch(e){A=AudioContext}A=new A();
P=(f)=>{o=A.createOscillator();T=A.currentTime;o.start(0);o.stop(T+.07);o.type="square";o.frequency.setValueAtTime(f,T+.03);L=A.createGain();L.connect(A.destination);L.gain.value = .03;o.connect(L);};
c=document.querySelector('canvas').getContext('2d');c.font="20px Arial";
X=200;Y=J=M=100;vy=g=k=d=t=f=S=V=h=x=G=F=N=D=Z=0;Q=1;p=[];r=Math.random;y=250;B="#000";W='#eef';E=.8;
// r=()=>Math.random()>.5?0:1;
l=(a,b)=>{p.push(a),b||r()>E&&H()};
n=()=>{f<30||r()<.1?(u(),u(f>300)):r()<.1&&f>200?v():y=(y+=(e=.5-r())*190)<150?150:y>400?400:y,l([x+=M+r()*186,y,M,10])};
u=(d)=>{l([x+=M,y,M,d?18:10])};
H=()=>{l([x+r()*79,y-15-r()*120,20,20],1)};
v=()=>{l([x+=200,y-=120,50,M],1);l([x-M,y+=120,250,11]);x+=50;}
C=(L)=>{c.fillStyle=L};
c.T=c.fillText;
c.R=c.fillRect;
// Z=2;
R=(x,y,w,H)=>x+w>=X&&x<X+30&&y+H>=Y+h&&y<=Y+30;
q=(i,j,w,h,e)=>{w-2&&t&&R(i,j,w,h)&&(w-20?vy>=0&&Y<=j?(Y=j-30,g=vy=0,h-18||(V=10)):w-50||K():(f+=30,e[2]=2,P(880+440*(1-E)),G=F+3,E*=.992));C(B);w-2?w-20?c.R(x=i,j,w,h):c.T('<3',i,j+20,C('#e23')):(c.T('+30',i,j,C('#db0')),e[1]-=2);h-18||c.T('>>>>>>>>>',i,j);}
s=()=>{
F++;
F%99||!D||(Z=(Z+1)%Q);
D?C('#faa'):C(W);
c.R(0,0,680,450);
C(B);
c.T('tap:FALL hold:CROUCH release:JUMP', 200,20);
I=Q*200;
c.R(20,70,160,2),
c.R(20,52,f/I*160,20),
g=g||vy>5;
t&&(vy+=[.3,.4,.3,.5,.3,.2][Z]);
vy=Z*k*g-2||vy<0?vy:1;
Y+=vy;
c.T(f,M,50);
m=k*(vy>=0);
h+=m*7-h/2;
V+=([4,5,3+6*g,8,6,9][Z]-V)/20;
z=V*!D-(k||Z-4?0:-vy)
p.forEach(e=>{q(e[0]-=z,e[1]+Math.cos(e[0]/M)*10,e[2],e[3],e)});
x<=680&&n();
p[0][0]<-p[0][2]&&p.shift();
C(["#d26","#2a7","#f0f",'#0af',"#62d","#000"][Z])
f>3e3&&C("#cc3");
c.R(X-vy/4,Y+h-(z==2?5:0),(Z==2?32:30)+vy/2,(z==1?35:30)-h);
c.T(['M','▮▮','oöo','=>>','>FF','[█]'][Z], X-3-vy/4,Y+10+h);
F<10&&F>2&&c.T(`Ɛ>${' '.repeat(F-2)}<3`,X+20-F*V,J);
C(W);
z="-.v }ñ"[Z];
m=0;
c.T(k||D?`>${z}<`:`^${z}^`, X+5,Y+20+vy+h/2);
Y>450&&(Y=420,K());
z=f<3e3;
D&&(e=240+999/F,c.R(e-20,50,200,240),C(B),
c.T(z?`<3's: ${f}`:'YAY u win',e,90),
F>40&&c.T(`Best: ${S=f>S?f:S}`,e,120),
c.R(e,148,160,2),
c.R(e,130,f/I*160,20),
c.T(Q-6?'new char at '+I:'final goal '+I,e,170),
N&&F%25>10&&c.T('*New Char Unlocked!',250,350,C(W)),
Q-1&&c.T('wait to change char',250,400,C(W)),
F%7||F>10&&F<44&&((z&&!N)?P(880-F*F):P(880+F*F)));
F==G&&(P(1200),G=0);
window.requestAnimationFrame(s);
}
s();
K=()=>{
t=vy=g=F=0,D=1,P(220),E=.8;
N=f<I||Q>5?0:Q++;
}
a=(e)=>{
e.metaKey||e.preventDefault();
J=Y+20;
!g||Z-1||(V=5);
!D?(k||P(550-Y)||(g&&(vy+=Z-5?10:15,Z-5||(V=0))),t||(f=N=0),k||(F=t=k=1)):F>50?(D=0,Y=M):0;
}
b=()=>{
D||!k||!g||Z-2||(vy=10);
D||!k||g||(J=Y+20,vy=Z-5?-10:-7,Z-1||(V=10),f+=!g*5,g=F=1,P(880-Y));
k=0;
}
w=addEventListener.bind(window);
w('keydown',a);
w('keyup',b);
w('touchstart',a,{passive:false});
w('touchend',b);
</script>