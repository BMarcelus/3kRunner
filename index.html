<style>*{height:100%;margin:0;}</style>
<meta charset="UTF-8">
<canvas width=880 height=450>
<script>
//Copyright Brian Dizon 2018
try{A=webkitAudioContext}catch(e){A=AudioContext}A=new A();
P=(f)=>{o=A.createOscillator();T=A.currentTime;o.start();o.stop(T+.07);o.type="square";o.frequency.setValueAtTime(f,T+.03);f=A.createGain();f.connect(A.destination);f.gain.value = .03;o.connect(f);};
c=document.querySelector('canvas').getContext('2d');c.font="20px Arial";
X=200;Y=J=M=100;$=vy=k=d=t=f=S=V=h=x=G=F=N=D=Z=0;g=Q=1;p=[];r=Math.random;y=250;B="#000";W='#eef';E=.8;
e=[];
// r=()=>Math.random()>.5?0:1;
l=(a,b)=>{p.push(a),b||r()>E&&H()};
n=()=>{f<30||r()<.1?(u(),u(f>300)):r()<.1&&f>200?v():y=(y+=(.5-r())*190)<150?150:y>400?400:y,l([x+=M+r()*186,y,M,10])};
u=(d)=>{l([x+=M,y,M,d?18:10])};
H=()=>{l([x+r()*79,y-15-r()*120,20,30],1)};
v=()=>{l([x+=200,y-=120,50,M],1);l([x-M,y+=120,250,11]);x+=50;u();}
C=(L)=>{c.fillStyle=L};
c.T=c.fillText;
c.R=c.fillRect;
// Z=2;
q=(i,j,w,H,e)=>{C(B);w-2&&t&&i+w>=X&&i<X+30&&j+H>=Y+h&&j<=Y+30&&(w-20?vy>=0&&Y<=j?(Y=j-30,Z-5||(e[1]+=vy),g=vy=0,H-18||(V=10)):w-50||(Z-2?K():P(V-=9,e[1]-=4)):(f+=30+10*Z,e[2]=2,P(880+440*(1-E)),G=F+3,E*=.992));w-2?w-20?c.R(x=i,j,w,H,w-50||Z-2||C('#a0a')):c.T('<3',i,j+20,C(R)):(c.T('+'+(30+10*Z),i,j,C(R)),e[1]-=1,e[0]+=V/2);H-18||c.T('>>>>>>>>>',i,j);}
s=()=>{
F++;
F*k*D<50||F%30||(Z++,Z%=Q);
D*F>50?Y+=(M-Y)/9:0;
C(D?'#faa':W);
c.R(0,0,1e3,450);
C(B);
c.T('tap:FALL hold:CROUCH release:JUMP', 200,20);
I=Q*Q*83+12;
c.R(20,70,660,2),
c.R(20,52,f/3e3*660,20),
c.R(20,81,($+f)/I*160,20),
c.R(20,99,160,2),
g=g||vy>5;
t&&(vy+=Z-1?Z-3?.3:.5:.4);
vy=t*Z*k*g-2||vy<0?vy:1;
Y+=vy;
c.T(f,M,50);
c.T($+f,M,20);
m=!D*k*(vy>=0);
h+=m*7-h/2;
V+=!D*([4,5,3+6*g,8,6,9+f/3e3*9][Z]-V)/20;
V=Z-5||!m?V:0;
z=V-(k||Z-4?0:-vy);
p.forEach(e=>{q(e[0]-=z,e[1]+Math.cos(e[0]/M)*10,e[2],e[3],e)});
x<=1e3&&n();
p[0][0]<-p[0][2]&&p.shift();
C(R=["#d26","#2a7","#f2f",'#0af',"#62d","#222"][Z])
c.T(['M','▮▮','oöo','=>>','>FF','[█]'][Z], X-3-vy/4,Y+10+h);
c.R(X-vy/4,Y+h-(z-2?0:5),30+Z+vy/2,(z==1?35:30)-h);
F<10&&F>2&&c.T(`Ɛ>${' '.repeat(F-2)}<3`,X+15-F*V,J);
e[Z]&&c.T(' ♕', X,Y+m*14,C('#db0'));
C(W);
z="-.v }ñ"[Z];
c.T(k||D?`>${z}<`:`^${z}^`, X+5,Y+20+vy+h/2);
Y>450&&(Y=420,K());
Y=Y<0?0:Y;
D?(m=260+999/F,c.R(m-20,50,200,240),C(B),
c.T(`<3's: ${f}!`,m,90),
F>40&&c.T(`Best: ${S=f>S?f:S}`,m,120),
c.R(m,258,160,2),
c.R(m,240,f/I*160,20),
c.T(Q-6?'new char at '+I:e[Z]?'YAY u win':'final goal 3k',m,280),
N&&F%25>10&&c.T('*New Char Unlocked!',m,150),
Q-1&&c.T('hold to change char',m,200),
F%7||F>10&&F<44&&((e[Z]||N)?P(880+F*F):P(880-F*F))):f<3e3?0:e[Z]=1;
F==G&&(P(1200),G=0);
$+f<I||Q>5?0:(N=Q++,$-=I);
window.requestAnimationFrame(s);
}
K=()=>{
V=t=vy=F=0,g=D=1,P(220),E=.8;
Z=N?Q-1:Z;
// N=f<I||Q>5?0:Z=Q++;
}
a=(e)=>{
e.metaKey||e.preventDefault();
J=Y+20;
D?k||F<50||(F=60):k||P(550-Y,F=t=k=1)||(g&&(vy+=10,Z-1||(V=5)));
k=1;
}
b=()=>{
D?F>50?($+=f,N=f=D=0,Y=M):0:k&&(g?Z-2||(vy=10):(J=Y+20,vy=-10,Z-1||(V=10),f+=!g*5*Q,g=F=1,P(880-Y)));
k=0;
}
w=addEventListener.bind(window);
w('keydown',a);
w('keyup',b);
w('touchstart',a,{passive:false});
w('touchend',b);
s();
</script>